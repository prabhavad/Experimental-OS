alias physicalSP S0;
physicalSP = ([PTBR + 2*(SP/512)]*512 + (SP)%512);

alias  sysCallNo S1;
sysCallNo = [physicalSP-1];

//Get Arguments stored in Stack SP-2 onwards

alias fileName S2;
S2 = [physicalSP-3];

//Create()
breakpoint;
if(sysCallNo==1) then
	//check if file is already present
	S3 = FAT;
	while (S3<3071) do //limit of FAT
		if([S3]==fileName) then
			[physicalSP-2]=0;
			ireturn;
		endif;
		S3=S3+8;		
	endwhile;
	breakpoint;
	//get Disk Free list
	S3=3072+24;
	while([S3]!=0 && S3<=3072+447) do
		S3=S3+1;
	endwhile;
	breakpoint;
	//No free Found
	if([S3]!=0) then
		[physicalSP-2]=-1;
		ireturn;
	endif;
	[S3]=1;
	alias basicBlock S3;
	basicBlock=basicBlock-3072;
	
	S4=FAT+2;
	while([S4]!=-1 && S4<3071) do
		S4=S4+8; 	
	endwhile;
	
	if([S4]!=-1) then
		[physicalSP-2]=-1;
		ireturn;	
	endif;
	S4=S4-2;
	[S4]=fileName;
	[S4+1]=0;
	[S4+2]=basicBlock;
	load(1,basicBlock);
	alias i S5;
	i=0;
	while(i<=255) do
		[512+i]=-1;
		i=i+1;
	endwhile;
	store(1,basicBlock);
	
	
	//update disk
	store (5,19);  // fat
	store (6,20);  //disk free list
	[physicalSP-2]=0;
	ireturn;
endif;




